name: ðŸš€ Build Ionic Vue APK - Windows Optimized

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]
  workflow_dispatch:

jobs:
  build-android:
    runs-on: windows-latest  # <-- SpÃ©cifique Windows !
    
    steps:
    - name: ðŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ðŸ—ï¸ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ðŸ“¦ Install dependencies (Windows optimized)
      run: |
        # Force npm (Ã©vite les problÃ¨mes de lock file)
        npm config set script-shell "C:\\Program Files\\Git\\bin\\bash.exe"
        npm ci --legacy-peer-deps --no-audit
        
    - name: âš¡ Install Ionic & Capacitor globally
      run: |
        npm install -g @ionic/cli @capacitor/cli --force
        
    - name: ðŸ—ï¸ Build Vue.js App
      run: |
        npm run build
        
    - name: ðŸ¤– Add Android platform
      run: |
        npx cap add android --no-deps
        
    - name: ðŸ”„ Sync Capacitor
      run: |
        npx cap sync android
        
    - name: â˜• Setup Java JDK 17 (Windows)
      uses: actions/setup-java@v4
      with:
        distribution: 'microsoft'
        java-version: '17'
        
    - name: ðŸ”¨ Build APK Debug
      run: |
        cd android
        .\gradlew.bat assembleDebug --info
        
    - name: ðŸ“¤ Upload APK as artifact
      uses: actions/upload-artifact@v4
      with:
        name: mobile-app-debug
        path: android/app/build/outputs/apk/debug/*.apk
        retention-days: 7
        
    - name: ðŸŽ‰ Build Success Notification
      if: success()
      run: |
        echo "========================================"
        echo "âœ… BUILD RÃ‰USSI !"
        echo "ðŸ“± APK gÃ©nÃ©rÃ© avec succÃ¨s"
        echo "ðŸ“¥ TÃ©lÃ©chargez-le dans 'Artifacts'"
        echo "========================================"
